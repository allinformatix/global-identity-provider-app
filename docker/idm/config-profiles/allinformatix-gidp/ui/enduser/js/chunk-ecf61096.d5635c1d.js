/*!
 * Copyright 2019-2020 ForgeRock AS. All Rights Reserved 
 *  Use of this code requires a commercial software license with ForgeRock AS. or with one of its affiliates. All use shall be exclusively subject to such license between the licensee and ForgeRock AS.
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ecf61096"],{a2d6:function(e,t,a){},bffd:function(e,t,a){"use strict";a("a2d6")},cbf6:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("b-container",[a("div",{staticClass:"card mt-4"},[a("div",{staticClass:"card-header py-2"},[a("b-row",[a("b-col",{staticClass:"my-1",attrs:{md:"6"}},[a("div",{staticClass:"float-left"},[e.createProperties.length>0?a("b-btn",{directives:[{name:"b-modal",rawName:"v-b-modal.createResourceModal",modifiers:{createResourceModal:!0}}],staticClass:"mr-3",attrs:{type:"button",variant:"primary"}},[a("i",{staticClass:"fa fa-plus mr-2 pr-1"}),e._v(e._s(e.$t("common.form.new"))+" "+e._s(this.name))]):e._e(),e.userCanDelete&&this.selected.length?a("b-btn",{directives:[{name:"b-modal",rawName:"v-b-modal.deleteModal",modifiers:{deleteModal:!0}}],attrs:{type:"button",variant:"outline-secondary"}},[a("i",{staticClass:"fa fa-trash mr-3"}),e._v(e._s(e.$t("common.form.delete")))]):e._e()],1)]),a("b-col",{staticClass:"my-1",attrs:{md:"6"}},[a("div",{staticClass:"d-flex"},[a("b-input-group",{staticClass:"ml-auto pr-0"},[a("b-input-group-prepend",[a("div",{staticClass:"input-group-text inset"},[a("i",{staticClass:"fa fa-search"})])]),a("b-form-input",{staticClass:"inset-left inset-right",attrs:{placeholder:e.searchPlaceholder},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}}),a("b-input-group-append",[a("b-btn",{staticClass:"inset clear",attrs:{variant:"outline-default",disabled:!e.filter},on:{click:e.clear}},[a("i",{staticClass:"fa fa-times-circle"})])],1)],1)],1)])],1)],1),a("div",{staticClass:"card-body"},[a("b-table",{ref:"managedArrayGrid",staticClass:"mb-0",class:[{"hide-header":e.isLoading||!e.gridData.length}],attrs:{"show-empty":"","table-responsive":"",stacked:"lg",selectable:"",items:e.gridData,fields:e.columns,"per-page":0,hover:e.tableHover,"sort-by":e.sortBy,"sort-desc":e.sortDesc,"no-local-sorting":!0,"sort-direction":e.sortDirection,busy:e.isLoading},on:{"update:sortBy":function(t){e.sortBy=t},"update:sort-by":function(t){e.sortBy=t},"update:sortDesc":function(t){e.sortDesc=t},"update:sort-desc":function(t){e.sortDesc=t},"row-selected":e.onRowSelected,"row-clicked":e.resourceClicked,"sort-changed":e.sortingChanged},scopedSlots:e._u([{key:"head(selected)",fn:function(){return[a("div",{directives:[{name:"show",rawName:"v-show",value:e.gridData.length>0&&e.userCanDelete,expression:"gridData.length > 0 && userCanDelete"}],staticClass:"cursor-pointer"},[a("b-form-checkbox",{staticClass:"pl-4",on:{change:e.toggleSelectAll},model:{value:e.allRowsSelected,callback:function(t){e.allRowsSelected=t},expression:"allRowsSelected"}})],1)]},proxy:!0},{key:"cell(selected)",fn:function(t){return[a("b-form-checkbox",{staticClass:"pl-4",attrs:{id:"rowSelectCheckbox_"+t.index},on:{change:function(a){return e.onSelectRowCheckboxClicked(a,t.index)}},model:{value:t.rowSelected,callback:function(a){e.$set(t,"rowSelected",a)},expression:"data.rowSelected"}})]}},{key:"table-busy",fn:function(){return[a("div",{staticClass:"text-center p-5"},[a("b-spinner",{staticClass:"align-middle spinner-large text-primary my-4"}),a("div",[e._v(e._s(e.$t("common.form.loading"))+" "+e._s(e.plural(e.name))+"...")])],1)]},proxy:!0}])})],1),e.isLoading?e._e():a("div",{staticClass:"card-footer py-2"},[a("nav",{attrs:{"aria-label":"Page navigation example"}},[a("ul",{staticClass:"pagination justify-content-center mb-0"},[a("li",{class:[{disabled:1===e.currentPage},"page-item"],on:{click:function(t){t.preventDefault(),1!==e.currentPage&&e.paginationChange(1)}}},[a("a",{staticClass:"page-link",attrs:{href:"#"}},[a("i",{staticClass:"fa fa-angle-double-left"})])]),a("li",{class:[{disabled:1===e.currentPage},"page-item"],on:{click:function(t){t.preventDefault(),1!==e.currentPage&&e.paginationChange(e.currentPage-1)}}},[a("a",{staticClass:"page-link",attrs:{href:"#"}},[a("i",{staticClass:"fa fa-angle-left"})])]),a("li",{class:[{disabled:e.lastPage},"page-item"],on:{click:function(t){t.preventDefault(),!e.lastPage&&e.paginationChange(e.currentPage+1)}}},[a("a",{staticClass:"page-link",attrs:{href:"#"}},[a("i",{staticClass:"fa fa-angle-right"})])])])])])]),e.createProperties.length>0?a("fr-create-resource",{attrs:{resourceName:e.name,resourceType:e.resource,createProperties:e.createProperties},on:{refreshGrid:e.clear}}):e._e(),a("b-modal",{ref:"deleteModal",attrs:{id:"deleteModal",title:e.modalTitle}},[a("div",{staticClass:"pb-5"},[e._v(" "+e._s(e.modalBody)+" ")]),a("div",{staticClass:"w-100",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("div",{staticClass:"float-right"},[a("b-btn",{attrs:{type:"button",variant:"btn-link text-danger"},on:{click:function(t){return e.$bvModal.hide("deleteModal")}}},[e._v(e._s(e.$t("common.form.cancel")))]),a("b-btn",{attrs:{type:"button",variant:"danger"},on:{click:e.deleteResource}},[e._v(e._s(e.$t("common.form.delete")))])],1)])])],1)},r=[],i=a("2ef0"),o=a.n(i),n=a("761a"),l=a.n(n),c=a("cee4"),d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("b-modal",{ref:"createModal",attrs:{id:"createResourceModal","cancel-variant":"outline-secondary"},on:{shown:e.focusField},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.saveForm(t))}}},[a("div",{staticClass:"d-flex w-100 h-100",attrs:{slot:"modal-header"},slot:"modal-header"},[a("h5",{staticClass:"modal-title align-self-center text-center"},[e._v(e._s(e.$t("common.form.new"))+" "+e._s(e.resourceName))]),a("button",{staticClass:"close",attrs:{type:"button","aria-label":"Close"},on:{click:e.hideModal}},[a("i",{staticClass:"fa fa-times"})])]),a("b-row",[a("b-col",[a("ValidationObserver",{ref:"observer",attrs:{slim:""}},[e.createProperties.length>0?a("b-form",{staticClass:"mb-3",attrs:{name:"edit-personal-form"}},[e._l(e.createProperties,(function(t,s){return["string"!==t.type&&"number"!==t.type||void 0!==t.encryption?e._e():a("b-form-group",{key:"createResource"+s},[t.title?a("label",{staticClass:"float-left",attrs:{for:"create-resource-"+t.key}},[e._v(e._s(t.title))]):a("label",{staticClass:"float-left",attrs:{for:"create-resource-"+t.key}},[e._v(e._s(t.key))]),a("ValidationProvider",{attrs:{rules:t.required?"required":"",name:t.title,vid:t.key},scopedSlots:e._u([{key:"default",fn:function(s){return[a("b-form-input",{attrs:{id:"create-resource-"+t.key,type:"string"===t.type?"text":t.type,state:e.getValidationState(s)},model:{value:e.formFields[t.key],callback:function(a){e.$set(e.formFields,t.key,"string"===typeof a?a.trim():a)},expression:"formFields[field.key]"}}),a("b-form-invalid-feedback",[e._v(e._s(s.errors[0]))])]}}],null,!0)})],1),"array"===t.type&&"relationship"===t.items.type?a("b-form-group",{key:"createResource"+s},[a("fr-relationship-edit",{attrs:{relationshipProperty:t,index:s,setValue:e.setRelationshipArrayValue,newResource:!0}})],1):e._e(),"boolean"===t.type?a("b-form-group",{key:"createResource"+s},[a("div",{staticClass:"d-flex flex-column"},[a("label",{staticClass:"mr-auto",attrs:{for:t.title}},[e._v(e._s(t.title))]),a("b-form-checkbox",{staticClass:"fr-toggle-primary",attrs:{switch:"",size:"lg"},model:{value:e.formFields[t.key],callback:function(a){e.$set(e.formFields,t.key,a)},expression:"formFields[field.key]"}},[e._v(" "+e._s(e.formFields[t.key]?e.$t("common.form.yes"):e.$t("common.form.no"))+" ")])],1)]):e._e(),"relationship"===t.type?a("b-form-group",{key:"createResource"+s},[a("fr-relationship-edit",{attrs:{relationshipProperty:t,index:s,setValue:e.setSingletonRelationshipValue,newResource:!0}})],1):e._e()]})),e.passwordCheck?a("fr-password-policy-input",{attrs:{policyApi:e.resourceType+"/"+e.resourceName+"/policyTest"},model:{value:e.formFields["password"],callback:function(t){e.$set(e.formFields,"password",t)},expression:"formFields['password']"}},[a("b-form-group",{staticClass:"mb-3",attrs:{slot:"custom-input"},slot:"custom-input"},[a("label",{attrs:{for:"createPassword"}},[e._v(e._s(e.$t("pages.access.password")))]),a("div",{staticClass:"form-label-password form-label-group mb-0"},[a("b-form-input",{directives:[{name:"validate",rawName:"v-validate.initial",value:"required|policy",expression:"'required|policy'",modifiers:{initial:!0}}],attrs:{id:"createPassword",autocomplete:"password",type:e.passwordInputType,name:"password"},model:{value:e.formFields["password"],callback:function(t){e.$set(e.formFields,"password",t)},expression:"formFields['password']"}}),a("div",{staticClass:"input-group-append"},[a("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:e.revealNew}},[a("i",{class:[{"fa-eye-slash":!e.showPassword},{"fa-eye":e.showPassword},"fa"]})])])],1)])],1):e._e()],2):[a("h3",{staticClass:"text-center"},[e._v(e._s(e.$t("pages.access.noFields")))])]],2)],1)],1),a("div",{staticClass:"w-100",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("div",{staticClass:"float-right"},[a("b-btn",{attrs:{variant:"outline-secondary mr-2"},on:{click:e.hideModal}},[e._v(e._s(e.$t("common.form.cancel")))]),a("b-btn",{attrs:{type:"button",variant:"primary",disabled:e.disabled||0===e.formFields.length},on:{click:e.saveForm}},[e._v(e._s(e.$t("common.form.save")))])],1)])],1)},u=[],p=a("f8f2"),f=a("f13c"),h=a("eea2"),m={name:"Create-Resource",components:{"fr-password-policy-input":p["a"],"fr-relationship-edit":f["a"]},mixins:[h["a"]],props:{createProperties:{type:Array,required:!0,default:function(){return[]}},resourceName:{type:String,required:!0},resourceType:{type:String,required:!0}},data:function(){var e={},t=!1;return o.a.each(this.createProperties,(function(a){"string"===a.type||"number"===a.type?e[a.key]="":"relationship"===a.type?e[a.key]=null:"array"===a.type&&"relationship"===a.items.type?e[a.key]=[]:e[a.key]=!1,"password"===a.key&&(t=!0)})),{formFields:e,passwordCheck:t,passwordInputType:"password",showPassword:!0,disabled:!1}},methods:{saveForm:function(){var e=this,t=this.getRequestService();this.$refs.observer.validate().then((function(a){if(a){var s=e.cleanData(o.a.clone(e.formFields));e.disabled=!0,t.post("".concat(e.resourceType,"/").concat(e.resourceName,"?_action=create"),s).then((function(){e.$emit("refreshGrid"),e.$refs.observer.reset(),e.hideModal(),e.displayNotification("success",e.$t("pages.access.successCreate",{resource:o.a.capitalize(e.resourceName)}))})).catch((function(t){var a=e.findPolicyError(t.response,e.createProperties);if(a.length>0){var s={};o.a.each(a,(function(e){e.exists&&(void 0!==s[e.field]?s[e.field].push(e.msg):s[e.field]=[e.msg])})),e.$refs.observer.setErrors(s)}else e.displayNotification("error",e.$t("pages.access.invalidCreate"))})).finally((function(){e.disabled=!1}))}else e.displayNotification("error",e.$t("pages.access.invalidCreate"))}))},hideModal:function(){this.resetDialog(),this.$refs.createModal.hide()},resetDialog:function(){var e=this;this.$refs.observer&&this.$refs.observer.reset(),this.passwordInputType="password",this.showPassword=!0,o.a.each(this.formFields,(function(t,a){var s=o.a.find(e.createProperties,{key:a});o.a.isString(t)||o.a.isNumber(t)?e.formFields[a]="":o.a.isArray(t)?e.formFields[a]=[]:"boolean"===s.type?e.formFields[a]=!1:e.formFields[a]=null}))},revealNew:function(){"password"===this.passwordInputType?(this.passwordInputType="text",this.showPassword=!1):(this.passwordInputType="password",this.showPassword=!0)},cleanData:function(e){return o.a.each(e,(function(t,a){(o.a.isString(t)&&0===t.length||o.a.isArray(t)&&0===t.length)&&delete e[a]})),e},focusField:function(){o.a.isArray(this.$refs.focusInput)&&this.$refs.focusInput[0].focus()},getRelationshipDisplayFields:function(e,t){return o.a.find(e.resourceCollection,{path:t._refResourceCollection}).query.fields},setSingletonRelationshipValue:function(e,t){this.formFields[e]=t},setRelationshipArrayValue:function(e,t){var a=this.formFields[e];t&&a&&-1===o.a.findIndex(a,{_ref:t._ref})&&a.push(t)}}},y=m,g=a("2877"),b=Object(g["a"])(y,d,u,!1,null,null,null),v=b.exports,w={name:"Access",components:{"fr-create-resource":v},mixins:[h["a"]],data:function(){return{name:this.$route.params.resourceName,resource:this.$route.params.resourceType,schemaProperties:{},isRowSelected:!1,tableHover:!0,gridData:[],columns:[],displayFields:[],currentPage:1,lastPage:!1,sortBy:null,sortDesc:!1,sortDirection:"asc",filter:"",createProperties:[],userCanUpdate:!1,userCanDelete:!1,isLoading:!0,queryThreshold:null,selected:[],allRowsSelected:!1}},mounted:function(){this.loadData()},watch:{gridData:function(){var e=this;this.columns=this.columns.map((function(t){return"actions"!==t.key&&"selected"!==t.key&&(t.sortable=!e.queryThreshold||e.filter.length>=e.queryThreshold),t}))}},computed:{searchPlaceholder:function(){return this.queryThreshold?this.$t("pages.access.typeAtLeastAndEnterToSearch",{numChars:this.queryThreshold}):this.$t("pages.access.typeAndEnterToSearch")},modalTitle:function(){return this.$t("pages.access.deleteManagedModalTitle",{managedName:this.name})},modalBody:function(){return this.$tc("pages.access.deleteManagedConfirm",this.selected.length,{count:this.selected.length,name:this.name})}},methods:{loadData:function(){var e=this,t=this.getRequestService(),a=this.$root.applicationStore.state.managedObjectsSettings;a&&a[this.name]&&(this.queryThreshold=a[this.name].minimumUIFilterLength),c["a"].all([this.getSchema("".concat(this.resource,"/").concat(this.name)),t.get("privilege/".concat(this.resource,"/").concat(this.name))]).then(c["a"].spread((function(t,a){a.data.DELETE.allowed&&(e.columns.push({key:"selected",label:"",class:"checkbox-column"}),e.userCanDelete=!0),a.data.VIEW.allowed&&o.a.each(a.data.VIEW.properties,(function(a){var s=t.data.properties[a];(e.columns.length<=3||e.userCanDelete&&e.columns.length<=4)&&o.a.isUndefined(s.encryption)&&o.a.includes(["string","boolean","number"],s.type)&&(e.columns.push({key:a,label:s.title,sortable:!0,sortDirection:"desc"}),e.displayFields.push(a))})),a.data.UPDATE&&(e.userCanUpdate=!0),e.schemaProperties=t.data.properties,a.data.CREATE.allowed&&o.a.each(a.data.CREATE.properties,(function(a){var s=t.data.properties[a].type;("string"===s||"number"===s||"boolean"===s||"relationship"===s||"array"===s&&"relationship"===t.data.properties[a].items.type)&&(t.data.properties[a].key=a,o.a.each(t.data.required,(function(e){e===t.data.properties[a].key&&(t.data.properties[a].required=!0)})),e.createProperties.push(t.data.properties[a]))})),e.loadGrid("true",e.displayFields,e.displayFields[0],1)}))).catch((function(t){e.displayNotification("error",t.response.data.message)}))},loadGrid:function(e,t,a,s){var r=this,i=this.getRequestService();this.isLoading=!0,i.get(this.buildGridUrl(e,t,a,s)).then((function(e){r.gridData=o.a.map(e.data.result,(function(e){return e.rowSelected=!1,e})),e.data.pagedResultsCookie?r.lastPage=!1:r.lastPage=!0,r.isLoading=!1})).catch((function(e){r.isLoading=!1,r.displayNotification("error",e.response.data.message)}))},buildGridUrl:function(e,t,a,s){var r="".concat(this.resource,"/").concat(this.name,"?_queryFilter=").concat(e,"&_pageSize=10");if(o.a.isNull(a)&&(a=t[0]),this.queryThreshold&&""===this.filter||(r="".concat(r,"&_sortKeys=").concat(a)),t.length&&(r="".concat(r,"&_fields=").concat(t.join(","))),s>1){var i=10*(s-1);r="".concat(r,"&_pagedResultsOffset=").concat(i)}return r},calculateSort:function(e,t){var a=null;return o.a.isNull(t)||(a=e?"".concat(t):"-".concat(t)),a},sortingChanged:function(e){this.currentPage=1,this.lastPage=!1,this.loadGrid(this.generateSearch(this.filter,this.displayFields,this.schemaProperties),this.displayFields,this.calculateSort(e.sortDesc,e.sortBy),1)},paginationChange:function(e){this.currentPage=e,this.loadGrid(this.generateSearch(this.filter,this.displayFields,this.schemaProperties),this.displayFields,this.calculateSort(this.sortDesc,this.sortBy),e)},search:function(){this.sortBy=null,this.sortDesc=!1,this.currentPage=1,this.lastPage=!1,(!this.queryThreshold||!this.filter.length||this.filter.length>=this.queryThreshold)&&this.loadGrid(this.generateSearch(this.filter,this.displayFields,this.schemaProperties),this.displayFields,null,1)},clear:function(){this.filter="",this.sortBy=null,this.sortDesc=!1,this.currentPage=1,this.loadGrid("true",this.displayFields,null,1)},resourceClicked:function(e){this.userCanUpdate?this.$router.push({name:"EditResource",params:{resourceType:this.resource,resourceName:this.name,resourceId:e._id}}):this.displayNotification("error",this.$t("pages.access.unableToEditResource",{resource:this.name}))},plural:function(e){return l()(e)},onRowSelected:function(e){this.selected=e,this.allRowsSelected=e.length===this.gridData.length},toggleSelectAll:function(e){e?this.$refs.managedArrayGrid.selectAllRows():this.$refs.managedArrayGrid.clearSelected()},onSelectRowCheckboxClicked:function(e,t){e?this.$refs.managedArrayGrid.selectRow(t):this.$refs.managedArrayGrid.unselectRow(t)},deleteResource:function(){var e=this,t=this.getRequestService(),a=o.a.map(this.selected,(function(a){return t.delete("managed/".concat(e.name,"/").concat(a._id))}));c["a"].all(a).then((function(){e.$refs.deleteModal.hide(),e.displayNotification("success",e.$t("pages.access.deleteResource")),e.loadData()})).catch((function(t){e.displayNotification("error",t.response.data.message)}))}}},C=w,k=(a("bffd"),Object(g["a"])(C,s,r,!1,null,"19ad4f28",null));t["default"]=k.exports},eea2:function(e,t,a){"use strict";var s,r,i=a("2ef0"),o=a.n(i),n={name:"Resource-Mixin",methods:{generateUpdatePatch:function(e,t){var a,s=o.a.cloneDeep(e),r=o.a.cloneDeep(t);return o.a.isArray(r)?a=o.a.filter(r,(function(e,t){return e.value!==s[t].value})):(a=[],o.a.each(r,(function(e,t){o.a.isEqual(s[t],r[t])||a.push({value:r[t],name:t})}))),o.a.map(a,(function(e){return""===e.value||null===e.value?{operation:"remove",field:"/"+e.name}:{operation:"add",field:"/"+e.name,value:e.value}}))},findPolicyError:function(e,t){var a=this,s=[];return o.a.has(e,"data.detail.failedPolicyRequirements")&&o.a.each(e.data.detail.failedPolicyRequirements,(function(e){if(e.policyRequirements.length>0){var r="",i=o.a.find(t,(function(t){return t.key===e.property})),n=e.policyRequirements[0].params||{};i&&(r=i.title?i.title:i.key,n.property=r),s.push({exists:r.length>0,field:e.property,msg:a.$t("common.policyValidationMessages.".concat(e.policyRequirements[0].policyRequirement),n)})}})),s},generateSearch:function(e,t,a){var s="";return e.length>0?(e=encodeURIComponent(e),o.a.each(t,(function(r,i){var n="string";o.a.isUndefined(a)||(n=a[r].type),s=("number"!==n||o.a.isNaN(o.a.toNumber(e)))&&("boolean"!==n||"true"!==e&&"false"!==e)?i+1<t.length?"".concat(s).concat(r,'+sw+"').concat(e,'"+OR+'):"".concat(s).concat(r,'+sw+"').concat(e,'"'):i+1<t.length?"".concat(s).concat(r,"+eq+ ").concat(e,"+OR+"):"".concat(s).concat(r,"+eq+ ").concat(e)}))):s="true",s}}},l=n,c=a("2877"),d=Object(c["a"])(l,s,r,!1,null,null,null);t["a"]=d.exports}}]);
//# sourceMappingURL=chunk-ecf61096.d5635c1d.js.map
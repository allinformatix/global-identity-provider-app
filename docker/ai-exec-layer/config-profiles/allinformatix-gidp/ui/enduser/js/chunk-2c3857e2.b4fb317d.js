/*!
 * Copyright 2019-2020 ForgeRock AS. All Rights Reserved 
 *  Use of this code requires a commercial software license with ForgeRock AS. or with one of its affiliates. All use shall be exclusively subject to such license between the licensee and ForgeRock AS.
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2c3857e2"],{"484a":function(e,t,i){},"9e67":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("b-modal",{ref:"fsModal",attrs:{id:"userDetailsModal","modal-class":"fr-full-screen","cancel-variant":"outline-secondary"},on:{show:e.setModal},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.saveForm(t))}}},[i("div",{staticClass:"d-flex w-100 h-100",attrs:{slot:"modal-header"},slot:"modal-header"},[i("h5",{staticClass:"modal-title align-self-center text-center"},[e._v(e._s(e.title))]),i("button",{staticClass:"close",attrs:{type:"button","aria-label":"Close"},on:{click:e.hideModal}},[i("i",{staticClass:"fa fa-times"})])]),i("b-container",[i("b-row",[i("b-col",{attrs:{sm:"8","offset-sm":"2"}},[i("ValidationObserver",{ref:"observer",attrs:{slim:""}},[e.formFields.length>0?i("b-form",{staticClass:"mb-3 fr-edit-personal-form",staticStyle:{"flex-direction":"column"},attrs:{name:"edit-personal-form"}},[e._l(e.formFields,(function(t,a){return["string"!==t.type&&"number"!==t.type||!t.viewable?e._e():i("b-form-group",{key:a,staticStyle:{"min-width":"200px"}},[i("label",{attrs:{for:t.title}},[e._v(e._s(t.title))]),t.required?e._e():i("small",{staticClass:"text-muted ml-1"},[e._v(e._s(e.$t("pages.profile.editProfile.optional")))]),i("ValidationProvider",{attrs:{rules:t.required?"required":"",name:t.name},scopedSlots:e._u([{key:"default",fn:function(l){return[t.options.length?i("b-select",{attrs:{name:t.name,state:e.getValidationState(l),options:t.options},model:{value:e.formFields[a].value,callback:function(t){e.$set(e.formFields[a],"value","string"===typeof t?t.trim():t)},expression:"formFields[index].value"}}):i("b-input",{attrs:{disabled:!t.userEditable,name:t.name,type:"string"===t.type?"text":t.type,state:e.getValidationState(l)},model:{value:e.formFields[a].value,callback:function(t){e.$set(e.formFields[a],"value","string"===typeof t?t.trim():t)},expression:"formFields[index].value"}}),i("b-form-invalid-feedback",[e._v(e._s(l.errors[0]))])]}}],null,!0)})],1),"boolean"===t.type?i("b-form-group",{key:a},[t.viewable?i("div",{staticClass:"d-flex flex-column"},[i("label",{staticClass:"mr-auto",attrs:{for:t.title}},[e._v(e._s(t.title)),t.required?e._e():i("small",{staticClass:"text-muted ml-1"},[e._v(e._s(e.$t("pages.profile.editProfile.optional")))])]),i("b-form-checkbox",{staticClass:"fr-toggle-primary",attrs:{switch:"",size:"lg",disabled:!t.userEditable},model:{value:e.formFields[a].value,callback:function(t){e.$set(e.formFields[a],"value",t)},expression:"formFields[index].value"}},[e._v(" "+e._s(e.formFields[a].value?e.$t("common.form.yes"):e.$t("common.form.no"))+" ")])],1):e._e()]):e._e(),"array"===t.type&&"relationship"!==t.items.type?i("b-form-group",{key:a},[t.viewable?i("div",{staticClass:"d-flex flex-column"},[i("label",{staticClass:"mr-auto",attrs:{for:t.title}},[e._v(e._s(t.title)+" "),t.required?e._e():i("small",{staticClass:"text-muted ml-1"},[e._v(e._s(e.$t("pages.profile.editProfile.optional")))])]),i("FrListField",e._g({attrs:{value:e.formFields[a].value,description:t.description,items:t.items,label:t.title,name:t.name,required:t.required,index:a,disabled:!t.userEditable},on:{input:function(t){return e.updateField(a,t)}}},e.$listeners))],1):e._e()]):e._e()]}))],2):[i("h3",{staticClass:"text-center"},[e._v(e._s(e.$t("pages.profile.editProfile.noFields")))])]],2)],1)],1)],1),i("div",{staticClass:"w-100",attrs:{slot:"modal-footer"},slot:"modal-footer"},[i("div",{staticClass:"float-right"},[i("b-btn",{attrs:{variant:"outline-secondary mr-2"},on:{click:e.hideModal}},[e._v(e._s(e.$t("common.form.cancel")))]),i("b-btn",{attrs:{type:"button",variant:"primary",disabled:e.$root.userStore.state.internalUser},on:{click:e.saveForm}},[e._v(e._s(e.$t("common.form.saveChanges")))])],1)])],1)},l=[],r=i("2ef0"),s=i.n(r),o=i("1a3e"),n=i("eea2"),d={name:"Edit-Personal-Info",mixins:[n["a"]],components:{FrListField:o["a"]},props:{schema:{type:Object,required:!0},profile:{type:Object,required:!0},autoOpen:{type:Boolean,required:!1,default:!1}},data:function(){return{formFields:[],originalFormFields:[],title:this.$t("pages.profile.editProfile.userDetailsTitle")}},mounted:function(){this.autoOpen&&this.$root.$emit("bv::show::modal","userDetailsModal")},methods:{generateFormFields:function(){var e=this,t=this.schema,i=t.order,a=t.properties,l=t.required,r=s.a.filter(i,(function(e){return a[e].viewable&&"object"!==a[e].type})),o=s.a.map(r,(function(t){return{name:t,key:t,title:a[t].title,userEditable:a[t].userEditable,viewable:a[t].viewable,value:e.profile[t]||null,type:a[t].type,required:s.a.includes(l,t),items:a[t].items,options:e.PopulateSelectList(a[t])}}));return o},hideModal:function(){this.$refs.fsModal.hide()},setModal:function(){var e=this.generateFormFields();this.formFields=e,this.originalFormFields=s.a.cloneDeep(e)},saveForm:function(){var e=this;this.$refs.observer.validate().then((function(t){if(t){var i=e.getRequestService(),a={};s.a.each(e.formFields,(function(e){null!==e.value&&(a[e.name]=e.value)})),i.post("policy/".concat(e.$root.userStore.state.managedResource,"/").concat(e.$root.userStore.state.userId,"?_action=validateObject"),a).then((function(t){if(t.data.failedPolicyRequirements=s.a.remove(t.data.failedPolicyRequirements,(function(t){return!s.a.map(e.formFields,"name").includes(t.property)})),0===t.data.failedPolicyRequirements.length){var i=s.a.map(s.a.cloneDeep(e.formFields),(function(t,i){return"array"===t.type&&t.value&&null===e.originalFormFields[i].value&&0===t.value.length&&(t.value=null),t}));e.$emit("updateProfile",e.generateUpdatePatch(e.originalFormFields,i)),e.$refs.observer.reset(),e.hideModal()}else{var a=e.findPolicyError({data:{detail:{failedPolicyRequirements:t.data.failedPolicyRequirements}}},e.formFields);if(a.length>0){var l={};s.a.each(a,(function(e){e.exists&&(void 0!==l[e.field]?l[e.field].push(e.msg):l[e.field]=[e.msg])})),e.$refs.observer.setErrors(l)}else e.displayNotification("error",e.$t("pages.profile.editProfile.failedProfileSave"))}}))}}))},updateField:function(e,t){this.formFields[e].value=t,this.$forceUpdate()},PopulateSelectList:function(e){var t=[];return e.enum&&e.enum.length&&(t=s.a.map(e.enum,(function(t,i){return{text:e.options&&e.options.enum_titles?e.options.enum_titles[i]:t,value:t}}))),t}}},u=d,f=(i("e03f"),i("2877")),m=Object(f["a"])(u,a,l,!1,null,null,null);t["default"]=m.exports},e03f:function(e,t,i){"use strict";i("484a")}}]);
//# sourceMappingURL=chunk-2c3857e2.b4fb317d.js.map